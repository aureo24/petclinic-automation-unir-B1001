{"version":3,"file":"MessageWriter.js","names":["_fs","require","_process","_interopRequireDefault","_utils","e","__esModule","default","MessageWriter","constructor","bus","sendData","path","type","data","_process$send","event","toString","emit","JSON","stringify","process","send","call","writeJson","Buffer","from","writeAttachment","distFileName","content","writeAttachmentFromPath","readFileSync","writeEnvironmentInfo","info","text","stringifyProperties","writeCategoriesDefinitions","categories","writeGroup","result","concat","uuid","writeResult","exports"],"sources":["../../../../../src/sdk/reporter/writer/MessageWriter.ts"],"sourcesContent":["import { readFileSync } from \"fs\";\nimport type { EventEmitter } from \"node:events\";\nimport process from \"process\";\nimport type { TestResult, TestResultContainer } from \"../../../model.js\";\nimport type { Category, EnvironmentInfo } from \"../../types.js\";\nimport type { Writer } from \"../types.js\";\nimport { stringifyProperties } from \"../utils.js\";\n\ntype EventType = \"result\" | \"container\" | \"attachment\" | \"misc\";\n\nexport class MessageWriter implements Writer {\n  constructor(private bus?: EventEmitter) {}\n\n  private sendData(path: string, type: EventType, data: Buffer) {\n    const event = { path, type, data: data.toString(\"base64\") };\n\n    if (this.bus) {\n      this.bus.emit(\"allureWriterMessage\", JSON.stringify(event));\n      return;\n    }\n\n    process.send?.(JSON.stringify(event));\n  }\n\n  private writeJson(path: string, type: EventType, data: any) {\n    this.sendData(path, type, Buffer.from(JSON.stringify(data), \"utf-8\"));\n  }\n\n  writeAttachment(distFileName: string, content: Buffer): void {\n    this.sendData(distFileName, \"attachment\", content);\n  }\n\n  writeAttachmentFromPath(distFileName: string, from: string): void {\n    this.sendData(distFileName, \"attachment\", readFileSync(from));\n  }\n\n  writeEnvironmentInfo(info: EnvironmentInfo): void {\n    const text = stringifyProperties(info);\n\n    this.sendData(\"environment.properties\", \"misc\", Buffer.from(text, \"utf-8\"));\n  }\n\n  writeCategoriesDefinitions(categories: Category[]): void {\n    this.writeJson(\"categories.json\", \"misc\", categories);\n  }\n\n  writeGroup(result: TestResultContainer): void {\n    this.writeJson(`${result.uuid}-container.json`, \"container\", result);\n  }\n\n  writeResult(result: TestResult): void {\n    this.writeJson(`${result.uuid}-result.json`, \"result\", result);\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,GAAA,GAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAC,sBAAA,CAAAF,OAAA;AAIA,IAAAG,MAAA,GAAAH,OAAA;AAAkD,SAAAE,uBAAAE,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAI3C,MAAMG,aAAa,CAAmB;EAC3CC,WAAWA,CAASC,GAAkB,EAAE;IAAA,KAApBA,GAAkB,GAAlBA,GAAkB;EAAG;EAEjCC,QAAQA,CAACC,IAAY,EAAEC,IAAe,EAAEC,IAAY,EAAE;IAAA,IAAAC,aAAA;IAC5D,IAAMC,KAAK,GAAG;MAAEJ,IAAI;MAAEC,IAAI;MAAEC,IAAI,EAAEA,IAAI,CAACG,QAAQ,CAAC,QAAQ;IAAE,CAAC;IAE3D,IAAI,IAAI,CAACP,GAAG,EAAE;MACZ,IAAI,CAACA,GAAG,CAACQ,IAAI,CAAC,qBAAqB,EAAEC,IAAI,CAACC,SAAS,CAACJ,KAAK,CAAC,CAAC;MAC3D;IACF;IAEA,CAAAD,aAAA,GAAAM,gBAAO,CAACC,IAAI,cAAAP,aAAA,eAAZA,aAAA,CAAAQ,IAAA,CAAAF,gBAAO,EAAQF,IAAI,CAACC,SAAS,CAACJ,KAAK,CAAC,CAAC;EACvC;EAEQQ,SAASA,CAACZ,IAAY,EAAEC,IAAe,EAAEC,IAAS,EAAE;IAC1D,IAAI,CAACH,QAAQ,CAACC,IAAI,EAAEC,IAAI,EAAEY,MAAM,CAACC,IAAI,CAACP,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC,EAAE,OAAO,CAAC,CAAC;EACvE;EAEAa,eAAeA,CAACC,YAAoB,EAAEC,OAAe,EAAQ;IAC3D,IAAI,CAAClB,QAAQ,CAACiB,YAAY,EAAE,YAAY,EAAEC,OAAO,CAAC;EACpD;EAEAC,uBAAuBA,CAACF,YAAoB,EAAEF,IAAY,EAAQ;IAChE,IAAI,CAACf,QAAQ,CAACiB,YAAY,EAAE,YAAY,EAAE,IAAAG,gBAAY,EAACL,IAAI,CAAC,CAAC;EAC/D;EAEAM,oBAAoBA,CAACC,IAAqB,EAAQ;IAChD,IAAMC,IAAI,GAAG,IAAAC,0BAAmB,EAACF,IAAI,CAAC;IAEtC,IAAI,CAACtB,QAAQ,CAAC,wBAAwB,EAAE,MAAM,EAAEc,MAAM,CAACC,IAAI,CAACQ,IAAI,EAAE,OAAO,CAAC,CAAC;EAC7E;EAEAE,0BAA0BA,CAACC,UAAsB,EAAQ;IACvD,IAAI,CAACb,SAAS,CAAC,iBAAiB,EAAE,MAAM,EAAEa,UAAU,CAAC;EACvD;EAEAC,UAAUA,CAACC,MAA2B,EAAQ;IAC5C,IAAI,CAACf,SAAS,IAAAgB,MAAA,CAAID,MAAM,CAACE,IAAI,sBAAmB,WAAW,EAAEF,MAAM,CAAC;EACtE;EAEAG,WAAWA,CAACH,MAAkB,EAAQ;IACpC,IAAI,CAACf,SAAS,IAAAgB,MAAA,CAAID,MAAM,CAACE,IAAI,mBAAgB,QAAQ,EAAEF,MAAM,CAAC;EAChE;AACF;AAACI,OAAA,CAAAnC,aAAA,GAAAA,aAAA","ignoreList":[]}