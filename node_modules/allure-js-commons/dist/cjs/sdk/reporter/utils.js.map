{"version":3,"file":"utils.js","names":["_promises","require","_nodeCrypto","_nodeFs","_interopRequireDefault","_nodePath","_nodeProcess","_properties","_model","_FileSystemWriter","_MessageWriter","e","__esModule","default","ownKeys","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","asyncGeneratorStep","n","a","c","u","done","Promise","resolve","then","_asyncToGenerator","_next","_throw","randomUuid","randomUUID","exports","md5","str","createHash","update","digest","getTestResultHistoryId","result","_result$testCaseId","historyId","tcId","testCaseId","fullName","paramsString","parameters","p","excluded","sort","b","_a$name","_a$value","name","localeCompare","map","_p$name","_p$value","concat","join","paramsHash","getTestResultTestCaseId","undefined","getWorstStepResultStatusPriority","steps","priority","worstStatusPriority","step","_step$steps","stepStatusPriority","status","StatusByPriority","indexOf","getWorstStepResultStatus","readImageAsBase64","_ref","filePath","file","readFile","encoding","console","error","_x","getProjectRoot","cachedProjectRoot","resolveProjectRootByPath","cwd","process","nextDir","dir","fs","accessSync","path","constants","F_OK","_unused","dirname","getRelativePath","filepath","isAbsolute","projectRoot","relative","getPackageLabelFromPath","LabelName","PACKAGE","split","sep","v","deepClone","obj","JSON","parse","stringify","serialize","val","Map","Set","toString","getSuiteLabels","suites","parentSuite","suite","subSuites","labels","PARENT_SUITE","SUITE","SUB_SUITE","suiteLabelNames","ensureSuiteLabels","test","defaultSuites","_test$labels","find","l","includes","_test$labels2","reRegExpChar","reHasRegExpChar","RegExp","source","escapeRegExp","replace","parseProperties","properties","stringifyProperties","data","unicode","isUrl","potentialUrl","URL","applyLinkTemplate","template","formatLink","templates","link","url","originalUrl","type","_templates","formattedLink","urlTemplate","nameTemplate","LinkType","DEFAULT","formatLinks","links","createDefaultWriter","config","env","ALLURE_TEST_MODE","MessageWriter","emitter","FileSystemWriter","resultsDir"],"sources":["../../../../src/sdk/reporter/utils.ts"],"sourcesContent":["import { readFile } from \"fs/promises\";\nimport { createHash, randomUUID } from \"node:crypto\";\nimport type { EventEmitter } from \"node:events\";\nimport fs from \"node:fs\";\nimport path from \"node:path\";\nimport process from \"node:process\";\nimport properties from \"properties\";\nimport type { Label, Link, Status, StepResult, TestResult } from \"../../model.js\";\nimport { LabelName, LinkType, StatusByPriority } from \"../../model.js\";\nimport type { LinkConfig, LinkTemplate } from \"./types.js\";\nimport { FileSystemWriter } from \"./writer/FileSystemWriter.js\";\nimport { MessageWriter } from \"./writer/MessageWriter.js\";\n\nexport const randomUuid = () => {\n  return randomUUID();\n};\n\nexport const md5 = (str: string) => {\n  return createHash(\"md5\").update(str).digest(\"hex\");\n};\n\nexport const getTestResultHistoryId = (result: TestResult) => {\n  if (result.historyId) {\n    return result.historyId;\n  }\n\n  const tcId = result.testCaseId ?? (result.fullName ? md5(result.fullName) : null);\n\n  if (!tcId) {\n    return \"\";\n  }\n\n  const paramsString = result.parameters\n    .filter((p) => !p?.excluded)\n    .sort((a, b) => a.name?.localeCompare(b?.name) || a.value?.localeCompare(b?.value))\n    .map((p) => `${p.name ?? \"null\"}:${p.value ?? \"null\"}`)\n    .join(\",\");\n  const paramsHash = md5(paramsString);\n\n  return `${tcId}:${paramsHash}`;\n};\n\nexport const getTestResultTestCaseId = (result: TestResult) => {\n  return result.fullName ? md5(result.fullName) : undefined;\n};\n\nexport const getWorstStepResultStatusPriority = (steps: StepResult[], priority?: number): number | undefined => {\n  let worstStatusPriority = priority;\n\n  steps.forEach((step) => {\n    if (step.steps?.length) {\n      worstStatusPriority = getWorstStepResultStatusPriority(step.steps, worstStatusPriority);\n    }\n\n    const stepStatusPriority = step.status ? StatusByPriority.indexOf(step.status) : undefined;\n\n    if (stepStatusPriority === undefined) {\n      return;\n    }\n\n    if (worstStatusPriority === undefined) {\n      worstStatusPriority = stepStatusPriority;\n      return;\n    }\n\n    if (stepStatusPriority >= worstStatusPriority) {\n      return;\n    }\n\n    worstStatusPriority = stepStatusPriority;\n  });\n\n  return worstStatusPriority;\n};\n\nexport const getWorstStepResultStatus = (steps: StepResult[]): Status | undefined => {\n  const worstStatusPriority = getWorstStepResultStatusPriority(steps);\n\n  if (worstStatusPriority === undefined) {\n    return undefined;\n  }\n\n  return StatusByPriority[worstStatusPriority];\n};\n\nexport const readImageAsBase64 = async (filePath: string): Promise<string | undefined> => {\n  try {\n    const file = await readFile(filePath, { encoding: \"base64\" });\n\n    return file ? `data:image/png;base64,${file}` : undefined;\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(`could not read file ${filePath}`, e);\n    return undefined;\n  }\n};\n\nconst getProjectRoot = (() => {\n  let cachedProjectRoot: string | null = null;\n\n  const resolveProjectRootByPath = () => {\n    const cwd = process.cwd();\n    let nextDir = cwd;\n    let dir;\n\n    do {\n      dir = nextDir;\n      try {\n        fs.accessSync(path.join(dir, \"package.json\"), fs.constants.F_OK);\n\n        // package.json exists; use the directory as the project root\n        return dir;\n      } catch {}\n\n      nextDir = path.dirname(dir);\n    } while (nextDir.length < dir.length);\n\n    // package.json doesn't exist in any parent; fall back to CWD\n    return cwd;\n  };\n\n  return () => {\n    if (!cachedProjectRoot) {\n      cachedProjectRoot = resolveProjectRootByPath();\n    }\n    return cachedProjectRoot;\n  };\n})();\n\nexport const getRelativePath = (filepath: string) => {\n  if (path.isAbsolute(filepath)) {\n    const projectRoot = getProjectRoot();\n    filepath = path.relative(projectRoot, filepath);\n  }\n  return filepath;\n};\n\nexport const getPackageLabelFromPath = (filepath: string): Label => ({\n  name: LabelName.PACKAGE,\n  value: getRelativePath(filepath)\n    .split(path.sep)\n    .filter((v) => v)\n    .join(\".\"),\n});\n\nexport const deepClone = <T>(obj: T): T => JSON.parse(JSON.stringify(obj));\n\nexport const serialize = (val: unknown): string => {\n  if (typeof val === \"object\" && !(val instanceof Map || val instanceof Set)) {\n    return JSON.stringify(val);\n  }\n\n  if (val === undefined) {\n    return \"undefined\";\n  }\n\n  return (val as any).toString();\n};\n\nexport const getSuiteLabels = (suites: readonly string[]): Label[] => {\n  if (suites.length === 0) {\n    return [];\n  }\n\n  const [parentSuite, suite, ...subSuites] = suites;\n  const labels: Label[] = [];\n\n  if (parentSuite) {\n    labels.push({\n      name: LabelName.PARENT_SUITE,\n      value: parentSuite,\n    });\n  }\n\n  if (suite) {\n    labels.push({\n      name: LabelName.SUITE,\n      value: suite,\n    });\n  }\n\n  if (subSuites.length > 0) {\n    labels.push({\n      name: LabelName.SUB_SUITE,\n      value: subSuites.join(\" > \"),\n    });\n  }\n\n  return labels;\n};\n\nconst suiteLabelNames: readonly string[] = [LabelName.PARENT_SUITE, LabelName.SUITE, LabelName.SUB_SUITE];\n\nexport const ensureSuiteLabels = (test: Partial<TestResult>, defaultSuites: readonly string[]) => {\n  if (!test.labels?.find((l) => suiteLabelNames.includes(l.name))) {\n    test.labels = [...(test.labels ?? []), ...getSuiteLabels(defaultSuites)];\n  }\n};\n\nconst reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g,\n  reHasRegExpChar = RegExp(reRegExpChar.source);\n\nexport const escapeRegExp = (value: string): string => {\n  return reHasRegExpChar.test(value) ? value.replace(reRegExpChar, \"\\\\$&\") : value;\n};\n\nexport const parseProperties = properties.parse;\nexport const stringifyProperties = (data: any): string => properties.stringify(data, { unicode: true }).toString();\n\n// TODO: may also use URL.canParse instead (requires node.js v18.17, v19.9, or higher)\nconst isUrl = (potentialUrl: string) => {\n  // Short-circuits the check for many short URL cases, bypassing the try-catch logic.\n  if (potentialUrl.indexOf(\":\") === -1) {\n    return false;\n  }\n\n  // There is ':' in the string: a potential scheme separator.\n  // The string might be a proper URL already.\n  try {\n    new URL(potentialUrl);\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\n\nexport const applyLinkTemplate = (template: LinkTemplate, value: string) =>\n  typeof template === \"string\" ? template.replace(\"%s\", value) : template(value);\n\nexport const formatLink = (templates: LinkConfig, link: Link) => {\n  const { url: originalUrl, name, type } = link;\n  if (isUrl(originalUrl)) {\n    return link;\n  } else {\n    const formattedLink = { ...link };\n    const { urlTemplate, nameTemplate } = templates[type ?? LinkType.DEFAULT] ?? {};\n    if (urlTemplate !== undefined) {\n      formattedLink.url = applyLinkTemplate(urlTemplate, originalUrl);\n    }\n    if (name === undefined && nameTemplate !== undefined) {\n      formattedLink.name = applyLinkTemplate(nameTemplate, originalUrl);\n    }\n    return formattedLink;\n  }\n};\n\nexport const formatLinks = (templates: LinkConfig, links: readonly Link[]) =>\n  links.map((link) => formatLink(templates, link));\n\nexport const createDefaultWriter = (config: { resultsDir?: string; emitter?: EventEmitter }) => {\n  return process.env.ALLURE_TEST_MODE\n    ? new MessageWriter(config.emitter)\n    : new FileSystemWriter({\n        resultsDir: config.resultsDir || \"./allure-results\",\n      });\n};\n"],"mappings":"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","ignoreList":[]}